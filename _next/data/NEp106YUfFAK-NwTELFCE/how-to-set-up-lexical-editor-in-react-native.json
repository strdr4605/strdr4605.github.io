{"pageProps":{"postData":{"title":"How to set up Lexical editor in React Native","date":"2024-02-21T00:00:00.000Z","description":"We will look at how to build a rich text editor in React Native using lexical editor, with the help of react-native-webview.","tags":["react-native"],"slug":"how-to-set-up-lexical-editor-in-react-native","contentHtml":"<p>So you have a web app that uses Lexical editor and now you want to build the same editor on React Native, or maybe you just want to build a rich text editor in React Native using Lexical.\nBut unfortunately lexical does not <a href=\"https://github.com/facebook/lexical/discussions/2410\">support React Native</a> at the moment.</p>\n<p>So the idea that comes to mind is to try Lexical editor in a react-native-webview. There are similar solutions like <a href=\"https://github.com/imnapo/react-native-cn-quill\">react-native-cn-quill</a> and <a href=\"https://github.com/wxik/react-native-rich-editor\">react-native-rich-editor</a>.</p>\n<p>But as <a href=\"https://docs.expo.dev/guides/editing-richtext/#custom-webview-based-editor\">expo docs</a> say:</p>\n<blockquote>\n<p>If you need more configurability, you can build a similar library with an existing web-only editor.</p>\n</blockquote>\n<p>So let's implement a lexical editor in an Expo app.<br>\n(This is a demo project but you can follow the steps to add the editor to an existing React Native app)</p>\n<h2>Create the expo app</h2>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">npx create-expo-app <span class=\"token parameter variable\">-t</span> expo-template-blank-typescript\n</code></pre></div>\n<p>Now let's install <code class=\"language-unknown\">react-native-webview</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i react-native-webview\n</code></pre></div>\n<p>And make some changes in <code class=\"language-unknown\">App.tsx</code>, to display the WebView with <a href=\"https://playground.lexical.dev/\">https://playground.lexical.dev/</a> (for now).</p>\n<div class=\"remark-highlight\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// ./App.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">StyleSheet</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Text</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">View</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">WebView</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native-webview\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">View</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">container</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">View</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token string\">\"80%\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Lexical Webview</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">WebView</span></span>\n          <span class=\"token attr-name\">source</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> uri<span class=\"token operator\">:</span> <span class=\"token string\">\"https://playground.lexical.dev\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> marginTop<span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">View</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">View</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> styles <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">StyleSheet</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  container<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    flex<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">\"#e0e0e0\"</span><span class=\"token punctuation\">,</span>\n    alignItems<span class=\"token operator\">:</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span>\n    justifyContent<span class=\"token operator\">:</span> <span class=\"token string\">\"center\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We should have this result:</p>\n<p><img src=\"expo-webview-init.png#small\" alt=\"expo-webview-init\"></p>\n<h2>Add lexical editor</h2>\n<p>Other implementations for a rich text editor in react-native give us a predefined editor. However, we want to create our custom lexical editor with custom nodes and logic. So the only option is to create the editor from scratch.<br>\nHow? By creating a new app inside the project using <a href=\"https://docs.npmjs.com/cli/v7/using-npm/workspaces\">npm workspaces</a>.</p>\n<p>We add a workspace to <code class=\"language-unknown\">package.json</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-json  diff-highlight\"><code class=\"language-diff-json\"><span class=\"token unchanged language-json\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-native-lexical\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix unchanged\"> </span>  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix unchanged\"> </span>  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node_modules/expo/AppEntry.js\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"token inserted-sign inserted language-json\"><span class=\"token prefix inserted\">+</span>  <span class=\"token property\">\"workspaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token string\">\"lexical-editor\"</span>\n<span class=\"token prefix inserted\">+</span>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</span><span class=\"token unchanged language-json\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"expo start\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token property\">\"android\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"expo start --android\"</span><span class=\"token punctuation\">,</span></span>\n</code></pre></div>\n<blockquote>\n<p>We can name it how we want <code class=\"language-unknown\">post-editor</code>, <code class=\"language-unknown\">page-editor</code>. Also we can have multiple editors if needed.</p>\n</blockquote>\n<h3>Create web app as npm workspace</h3>\n<p>For this, we will use <a href=\"https://vitejs.dev/\">vite</a>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> create vite@latest lexical-editor -- <span class=\"token parameter variable\">--template</span> react-ts\n</code></pre></div>\n<p>Let's do a cleanup and some changes in lexical-editor app.</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">lexical-editor\n├── README.md\n├── index.html\n├── package.json\n├── src\n│   ├── App.tsx\n│   ├── index.css\n│   ├── main.tsx\n│   └── vite-env.d.ts\n├── tsconfig.json\n├── tsconfig.node.json\n└── vite.config.ts\n</code></pre></div>\n<p>Important to not enable zoom in the WebView, add this to <code class=\"language-unknown\">index.html</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>meta</span>\n  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, maximum-scale=0.99, user-scalable=0<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n<p>Now we can run the web app:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># in the root of expo app, we run script from lexical-editor workspace</span>\n<span class=\"token function\">npm</span> <span class=\"token parameter variable\">--workspace</span><span class=\"token operator\">=</span>lexical-editor run dev\n</code></pre></div>\n<p>And we can see this in the browser:</p>\n<p><img src=\"lexical-vite-init.png\" alt=\"lexical-vite-init\"></p>\n<p>Cool, now how can we put this into <code class=\"language-unknown\">react-native-webview</code>?!</p>\n<h3>Build a web app for react-native-webview</h3>\n<p>For this, we need some vite plugins that will build the app into a single file that we will import into react-native-webview.</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token parameter variable\">-w</span><span class=\"token operator\">=</span>lexical-editor i <span class=\"token parameter variable\">-D</span> vite-plugin-singlefile\n</code></pre></div>\n<p>and let's change the <code class=\"language-unknown\">vite.config.ts</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// .lexical-editor/vite.config.ts</span>\n<span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> defineConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> viteSingleFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vite-plugin-singlefile\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> react <span class=\"token keyword\">from</span> <span class=\"token string\">\"@vitejs/plugin-react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// https://vitejs.dev/config/</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  build<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    watch<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      include<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/**\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      buildDelay<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">react</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">viteSingleFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      name<span class=\"token operator\">:</span> <span class=\"token string\">\"vite-plugin-html-string\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">closeBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> bundle <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dist/index.html\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> escaped <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> js <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">export default </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>escaped<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n        fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dist/htmlString.ts\"</span><span class=\"token punctuation\">,</span> js<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This config watches for changes and builds the app into a single <code class=\"language-unknown\">index.html</code> file that we next write into a file named <code class=\"language-unknown\">htmlString.ts</code> so we can import it into react-native.</p>\n<p>Now we can run:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token parameter variable\">-w</span><span class=\"token operator\">=</span>lexical-editor run build\n</code></pre></div>\n<p>And vite will build the web editor on every change.</p>\n<p>Also, we need to build the app on install:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-json  diff-highlight\"><code class=\"language-diff-json\"><span class=\"token unchanged language-json\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc &#x26;&#x26; vite build\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"token inserted-sign inserted language-json\"><span class=\"token prefix inserted\">+</span>    <span class=\"token property\">\"prepare\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build -- --no-watch\"</span><span class=\"token punctuation\">,</span></span>\n</code></pre></div>\n<p>Only now we can import the output of the web app into react-native-webview:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-tsx  diff-highlight\"><code class=\"language-diff-tsx\"><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">StyleSheet</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Text</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">View</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">WebView</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native-webview\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\">htmlString</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./lexical-editor/dist/htmlString\"</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix unchanged\"> </span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Lexical Webview</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">WebView</span>\n<span class=\"token prefix unchanged\"> </span>          originWhitelist<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n</span><span class=\"token deleted-sign deleted language-tsx\"><span class=\"token prefix deleted\">-</span>          source<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> uri<span class=\"token operator\">:</span> <span class=\"token string\">\"https://playground.lexical.dev\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>          source<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> html<span class=\"token operator\">:</span> htmlString <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>          style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> marginTop<span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token prefix unchanged\"> </span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">View</span></span><span class=\"token punctuation\">></span></span></span>\n</code></pre></div>\n<p><img src=\"lexical-vite-webview.png#small\" alt=\"lexical-vite-webview\"></p>\n<h2>Create a basic lexical editor</h2>\n<p>Following <a href=\"https://lexical.dev/docs/getting-started/react\">https://lexical.dev/docs/getting-started/react</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token parameter variable\">-w</span><span class=\"token operator\">=</span>lexical-editor <span class=\"token function\">install</span> <span class=\"token parameter variable\">--save</span> lexical @lexical/react\n</code></pre></div>\n<p>We can create a basic lexical editor:</p>\n<div class=\"remark-highlight\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// lexical-editor/src/Editor.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">LexicalComposer</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalComposer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">PlainTextPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalPlainTextPlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ContentEditable</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalContentEditable\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">HistoryPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalHistoryPlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">LexicalErrorBoundary</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalErrorBoundary\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"./Editor.css\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>error<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Editor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initialConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    namespace<span class=\"token operator\">:</span> <span class=\"token string\">\"MyEditor\"</span><span class=\"token punctuation\">,</span>\n    onError<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">LexicalComposer</span></span> <span class=\"token attr-name\">initialConfig</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>initialConfig<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>editor-container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">PlainTextPlugin</span></span>\n          <span class=\"token attr-name\">contentEditable</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">ContentEditable</span></span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>editor-input<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">placeholder</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>editor-placeholder<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Enter some text...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">ErrorBoundary</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token maybe-class-name\">LexicalErrorBoundary</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">HistoryPlugin</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">LexicalComposer</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><img src=\"basic-lexical-editor.gif#small\" alt=\"basic-lexical-editor\"></p>\n<h2>Message from WebView to React Native</h2>\n<p>Let's add the <code class=\"language-unknown\">OnChangePlugin</code> and post a message to react-native:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-tsx  diff-highlight\"><code class=\"language-diff-tsx\"><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> $getRoot<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">EditorState</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"lexical\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">LexicalComposer</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalComposer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">PlainTextPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalPlainTextPlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ContentEditable</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalContentEditable\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">HistoryPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalHistoryPlugin\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">OnChangePlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalOnChangePlugin\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">LexicalErrorBoundary</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalErrorBoundary\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token string\">\"./Editor.css\"</span><span class=\"token punctuation\">;</span>\n</span>\n@@ -15,6 +17,22 @@ export function Editor() {\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>    onError<span class=\"token punctuation\">,</span>\n<span class=\"token prefix unchanged\"> </span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>  <span class=\"token keyword\">function</span> <span class=\"token function\">onChange</span><span class=\"token punctuation\">(</span>editorState<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">EditorState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>    editorState<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>      <span class=\"token keyword\">const</span> plainText <span class=\"token operator\">=</span> <span class=\"token function\">$getRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getTextContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>\n<span class=\"token prefix inserted\">+</span>      <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>        type<span class=\"token operator\">:</span> <span class=\"token string\">\"LEXICAL_EDITOR_STATE_CHANGE\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>        payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>          plainText<span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>          serializedEditorState<span class=\"token operator\">:</span> editorState<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>\n<span class=\"token prefix inserted\">+</span>      <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ReactNativeWebView</span></span><span class=\"token operator\">?.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>  <span class=\"token punctuation\">}</span>\n<span class=\"token prefix inserted\">+</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">LexicalComposer</span></span> <span class=\"token attr-name\">initialConfig</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>initialConfig<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>editor-container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span></span></span>@@ -26,6 +44,7 @@ export function Editor() {\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>          <span class=\"token maybe-class-name\">ErrorBoundary</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token maybe-class-name\">LexicalErrorBoundary</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">HistoryPlugin</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">OnChangePlugin</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">LexicalComposer</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token prefix unchanged\"> </span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n</code></pre></div>\n<p>Ok, now we can receive this message on the react-native side:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-tsx  diff-highlight\"><code class=\"language-diff-tsx\"><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">StyleSheet</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Text</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">View</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token deleted-sign deleted language-tsx\"><span class=\"token prefix deleted\">-</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">WebView</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native-webview\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">WebView</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">WebViewMessageEvent</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native-webview\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\">htmlString</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./lexical-editor/dist/htmlString\"</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>  <span class=\"token keyword\">function</span> <span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">WebViewMessageEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">nativeEvent</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>  <span class=\"token punctuation\">}</span>\n<span class=\"token prefix inserted\">+</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">View</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">container</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">View</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token string\">\"80%\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Lexical Webview</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>        &#x3C;WebView\n<span class=\"token prefix unchanged\"> </span>          originWhitelist=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span></span></span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>          onMessage<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onMessage<span class=\"token punctuation\">}</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>          source<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> html<span class=\"token operator\">:</span> htmlString <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>          style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> marginTop<span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token operator\">/</span><span class=\"token operator\">></span></span>\n</code></pre></div>\n<p>When we type something in the WebView editor we receive:</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"LEXICAL_EDITOR_STATE_CHANGE\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"payload\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"plainText\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hi\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"serializedEditorState\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"children\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"children\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n              <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"detail\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"mode\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"normal\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"style\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hi\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"direction\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ltr\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"indent\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"paragraph\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"direction\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ltr\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"indent\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>We can do a switch on <code class=\"language-unknown\">message.type</code> and handle any messages:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> WebViewMessageEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>nativeEvent<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"LEXICAL_EDITOR_STATE_CHANGE\"</span><span class=\"token operator\">:</span>\n      <span class=\"token comment\">// Do something with the editor state</span>\n      <span class=\"token comment\">// like saving it to a database</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unknown message type\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>Command from React Native to Webview</h2>\n<p>Let's say, we want to initialize the editor state when it is mounted.</p>\n<p>We listen for <code class=\"language-unknown\">LEXICAL_EDITOR_READY</code> message and post a message to webview using WebView ref.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-tsx  diff-highlight\"><code class=\"language-diff-tsx\">...\n<span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useRef <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>  <span class=\"token keyword\">const</span> webviewRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&#x3C;</span>WebView<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>  <span class=\"token keyword\">function</span> <span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">WebViewMessageEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">nativeEvent</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token spread operator\">...</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token comment\">// Do something with the editor state</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token comment\">// like saving it to a database</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>      <span class=\"token keyword\">case</span> <span class=\"token string\">\"LEXICAL_EDITOR_READY\"</span><span class=\"token operator\">:</span>\n<span class=\"token prefix inserted\">+</span>        <span class=\"token keyword\">const</span> commandMessage <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>          command<span class=\"token operator\">:</span> <span class=\"token string\">\"INIT_SERIALIZED_EDITOR_STATE\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>          payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>            root<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>              children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"token prefix inserted\">+</span>                <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>                  children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"token prefix inserted\">+</span>                    <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>                      detail<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      format<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      mode<span class=\"token operator\">:</span> <span class=\"token string\">\"normal\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      style<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      text<span class=\"token operator\">:</span> <span class=\"token string\">\"Initial text\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      type<span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                      version<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  direction<span class=\"token operator\">:</span> <span class=\"token string\">\"ltr\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  format<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  indent<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  type<span class=\"token operator\">:</span> <span class=\"token string\">\"paragraph\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                  version<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              direction<span class=\"token operator\">:</span> <span class=\"token string\">\"ltr\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              format<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              indent<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              type<span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>              version<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>\n<span class=\"token prefix inserted\">+</span>        webviewRef<span class=\"token punctuation\">.</span><span class=\"token property-access\">current</span><span class=\"token operator\">?.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>commandMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unknown message type\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">View</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token string\">\"80%\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Lexical Webview</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n<span class=\"token prefix unchanged\"> </span>        &#x3C;WebView\n<span class=\"token prefix unchanged\"> </span></span></span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>          ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>webviewRef<span class=\"token punctuation\">}</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>          originWhitelist<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>          onMessage<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onMessage<span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>          source<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> html<span class=\"token operator\">:</span> htmlString <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n</code></pre></div>\n<p>Now we need to handle this in Lexical editor. We can create a custom plugin.</p>\n<div class=\"remark-highlight\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useLexicalComposerContext <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalComposerContext\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">EditorStateInitPlugin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>editor<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useLexicalComposerContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"LEXICAL_EDITOR_READY\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ReactNativeWebView</span></span><span class=\"token operator\">?.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">listener</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">MessageEvent</span><span class=\"token operator\">&#x3C;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token property-access\">command</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"INIT_SERIALIZED_EDITOR_STATE\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        editor<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setEditorState</span><span class=\"token punctuation\">(</span>editor<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parseEditorState</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          tag<span class=\"token operator\">:</span> <span class=\"token string\">\"FromReactNativeToLexical\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> listener<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> listener<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>editor<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And use it in our <code class=\"language-unknown\">Editor.tsx</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff-tsx  diff-highlight\"><code class=\"language-diff-tsx\"><span class=\"token deleted-sign deleted language-tsx\"><span class=\"token prefix deleted\">-</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> $getRoot<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">EditorState</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"lexical\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> $getRoot<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">EditorState</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">LexicalEditor</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"lexical\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">LexicalComposer</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalComposer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">PlainTextPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalPlainTextPlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ContentEditable</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalContentEditable\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">HistoryPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalHistoryPlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">OnChangePlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalOnChangePlugin\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">LexicalErrorBoundary</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@lexical/react/LexicalErrorBoundary\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">EditorStateInitPlugin</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./plugins/EditorStateInitPlugin\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span><span class=\"token keyword\">import</span> <span class=\"token string\">\"./Editor.css\"</span><span class=\"token punctuation\">;</span>\n</span>\n...\n\n<span class=\"token deleted-sign deleted language-tsx\"><span class=\"token prefix deleted\">-</span>  <span class=\"token keyword\">function</span> <span class=\"token function\">onChange</span><span class=\"token punctuation\">(</span>editorState<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">EditorState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>  <span class=\"token keyword\">function</span> <span class=\"token function\">onChange</span><span class=\"token punctuation\">(</span>\n<span class=\"token prefix inserted\">+</span>    editorState<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">EditorState</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>    _latestEditor<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">LexicalEditor</span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>    tags<span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">Set</span><span class=\"token operator\">&#x3C;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token prefix inserted\">+</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tags<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FromReactNativeToLexical\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix inserted\">+</span>      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token prefix inserted\">+</span>    <span class=\"token punctuation\">}</span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>    editorState<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token prefix unchanged\"> </span>      <span class=\"token keyword\">const</span> plainText <span class=\"token operator\">=</span> <span class=\"token function\">$getRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getTextContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span>\n...\n\n<span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>          <span class=\"token maybe-class-name\">ErrorBoundary</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token maybe-class-name\">LexicalErrorBoundary</span><span class=\"token punctuation\">}</span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token prefix unchanged\"> </span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">HistoryPlugin</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"token inserted-sign inserted language-tsx\"><span class=\"token prefix inserted\">+</span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">EditorStateInitPlugin</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"token unchanged language-tsx\"><span class=\"token prefix unchanged\"> </span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">OnChangePlugin</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onChange<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token prefix unchanged\"> </span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token prefix unchanged\"> </span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">LexicalComposer</span></span><span class=\"token punctuation\">></span></span></span>\n</code></pre></div>\n<p>Let's see it in action:</p>\n<p><img src=\"lexical-initial-state.gif#small\" alt=\"lexical-initial-state\"></p>\n<h2>What's next?</h2>\n<p>Now you can add the desired nodes and plugins into editor. Also, add new messages and commands for communication between React Native and Lexical editor in WebView.</p>\n<p>For the full code example, you can check the playground project on GitHub, <a href=\"https://github.com/Planable/react-native-lexical\">react-native-lexical</a>.</p>\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true}