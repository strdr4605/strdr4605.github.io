{"pageProps":{"postData":{"title":"Nudge Github PR reviewers with Slack API","date":"2022-02-11T00:00:00.000Z","description":"How to create a simple script that will nudge Github Pull Request reviewers on Slack using Slack API and userscripts.","tags":["tools","github","userscript"],"slug":"nudge-github-pr-reviewers-with-slack-api","contentHtml":"<p>You know that moment when you have a Pull Request waiting for someone to review but days pass and no one is looking at it, so you have to manually ask reviewers in a public channel or privately. How we can automate this?</p>\n<p>Previously I was using Bitbucket and <a href=\"https://slack.com/apps/A8W8QLZD1-bitbucket-cloud?tab=more_info\">Bitbucket Cloud</a> have a cool feature to nudge reviewers from Slack and it will send a private message notifying reviewers to take a look at the Pull Request.</p>\n<p>Now I am using Github with <a href=\"https://slack.com/apps/A01BP7R4KNY-github?tab=more_info\">Github for Slack</a> and it has a feature to remind reviewers at a specific time of the day about PRs. But I could not find a nudge reviewer feature. I searched on the Slack app store but still had no success.</p>\n<p>I decided to do an MVP for my project and team, not publicly available, but you can create the same feature for your project/team/company.</p>\n<h2>Slack App</h2>\n<p>To publish messages to Slack workspace you need to create a <a href=\"https://api.slack.com/apps\">Slack App</a>.</p>\n<ol>\n<li>Click <strong>Create New App</strong> button</li>\n<li>Pick <strong>From scratch</strong></li>\n<li>Set <strong>App Name</strong> to <code class=\"language-unknown\">&#x26;lt;Company name&#x26;gt; PR nudge</code> (or any other suitable name)</li>\n<li>Pick your company workspace</li>\n<li>Press <strong>Create App</strong></li>\n</ol>\n<p>Next, we need to create a webhook for a Slack channel.</p>\n<ol>\n<li>In <strong>Add features and functionality</strong> section select <strong>Incoming Webhooks</strong></li>\n<li>Click <strong>Add New Webhook to Workspace</strong> and select a channel where all messages from <a href=\"https://slack.com/apps/A01BP7R4KNY-github?tab=more_info\">Github for Slack</a> goes (Usually this channel is named <code class=\"language-unknown\">#dev</code>)</li>\n</ol>\n<p>Now we have a webhook that will post messages to our channel, next we need to call this webhook from somewhere.</p>\n<h2>Userscript</h2>\n<p>Let's build a userscript that will add a <strong>Nudge reviewers</strong> button into Github PR page, that when clicked will nudge in Slack, reviewers that are awaited for review.</p>\n<p>If you don't know about userscripts you can check my explanation video: <a href=\"https://youtu.be/9yFi3-cfprQ\">You Don't Know *.user.js</a>.</p>\n<p><a href=\"https://youtu.be/9yFi3-cfprQ\" title=\"You Don&#x27;t Know *.user.js\"><img src=\"http://img.youtube.com/vi/9yFi3-cfprQ/0.jpg\" alt=\"You Don&#x27;t Know *.user.js\"></a></p>\n<p>First, your need a Userscript manager extension, let's install <a href=\"https://www.tampermonkey.net/\">Tampermonkey</a>.\nAfter installation open Tampermonkey and create a new script.</p>\n<h3>Userscript Header</h3>\n<p>We start with:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ==UserScript==</span>\n<span class=\"token comment\">// @name         &#x3C;Your Company> PR nudge</span>\n<span class=\"token comment\">// @namespace    https://github.com/&#x3C;Your Company></span>\n<span class=\"token comment\">// @version      1.0.0</span>\n<span class=\"token comment\">// @description  Nudge PR reviewers</span>\n<span class=\"token comment\">// @author       You</span>\n<span class=\"token comment\">// @match        https://github.com/&#x3C;Your Company>/*/pull/*</span>\n<span class=\"token comment\">// @icon         https://www.google.com/s2/favicons?sz=64&#x26;domain=github.com</span>\n<span class=\"token comment\">// @grant        GM_xmlhttpRequest</span>\n<span class=\"token comment\">// @connect      slack.com</span>\n<span class=\"token comment\">// ==/UserScript==</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Your code here...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We need:</p>\n<ul>\n<li><code class=\"language-unknown\">@match https://github.com/&#x26;lt;Your Company&#x26;gt;/*/pull/*</code> to run the script only when navigating to a PR page, such as\n<code class=\"language-unknown\">https://github.com/Org/Repo/pull/4605</code></li>\n<li><code class=\"language-unknown\">@grant GM_xmlhttpRequest</code> to do requests to Slack webhook</li>\n<li><code class=\"language-unknown\">@connect slack.com</code> to allow requests to Slack</li>\n</ul>\n<h3>Nudge reviewers button</h3>\n<p>Now let's create a <strong>Nudge reviewers</strong> button and add it to the Reviewers section:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">PR_NUDGE_WEBHOOK</span> <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"https://hooks.slack.com/services/********/***********/************************\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> nudgeButton <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  nudgeButton<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Nudge reviewers\"</span><span class=\"token punctuation\">;</span>\n  nudgeButton<span class=\"token punctuation\">.</span><span class=\"token property-access\">className</span> <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"btn btn-sm js-details-target d-inline-block float-left float-none m-0 mr-md-0 js-title-edit-button\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> reviewersFormElement <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"reviewers-select-menu\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">parentElement</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><img src=\"nudge_reviewers_button.png\" alt=\"nudge_reviewers_button\"></p>\n<h3>Who needs to review</h3>\n<p>This function will return a list with Github nicknames that should review this PR.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getAllAwaiting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> allReviewers <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>reviewersFormElement<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> awaiting <span class=\"token operator\">=</span> allReviewers<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reviewerEl</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span>\n    reviewerEl\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span[aria-label]\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aria-label\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Awaiting\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> awaitingNicknames <span class=\"token operator\">=</span> awaiting<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">reviewerEl</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> reviewerEl<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> awaitingNicknames<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>Mapping Github user with Slack user</h3>\n<p>Here is a sad part of this script, because we need to map Github with Slack, to know whom to nudge on Slack.\nAt this point, this is a manual process and this is the only downside of this solution.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">GithubSlackMap</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">strdr4605</span><span class=\"token operator\">:</span> <span class=\"token string\">\"U**********\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token spread operator\">...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">PR_NUDGE_WEBHOOK</span> <span class=\"token operator\">=</span>\n  <span class=\"token spread operator\">...</span>\n</code></pre></div>\n<p>To find the member ID from Slack, go to a Slack user profile, click <strong>More</strong>, and click <strong>Copy member ID</strong>.\nIf you have 30+ engineers in your team it may take a while. For me, it was 11 engineers.</p>\n<blockquote>\n<p>If you have an idea how to automate this, let me know.</p>\n</blockquote>\n<h3>onNudgeBtnClick</h3>\n<p>Now let's gather all the data and sent a request to Slack webhook.\nSlack has a specific format style for messages, so to tag people we need <code class=\"language-unknown\">slackMention</code> function.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">slackMention</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">githugNickname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">GithubSlackMap</span><span class=\"token punctuation\">[</span>githugNickname<span class=\"token punctuation\">]</span>\n    <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x3C;@</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token maybe-class-name\">GithubSlackMap</span><span class=\"token punctuation\">[</span>githugNickname<span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token operator\">:</span> githugNickname<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">onNudgeBtnClick</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> prLink <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> prTitle <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" by \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> prLink<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> awaitingReviewers <span class=\"token operator\">=</span> <span class=\"token function\">getAllAwaiting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>awaitingReviewers<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> dataObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hey </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>awaitingReviewers<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>\n      slackMention\n    <span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,\\nI really need your review on &#x3C;</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>prLink<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">|</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>prTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">>. ü•∫üòáüôèüòä</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\"><span class=\"token maybe-class-name\">GM_xmlhttpRequest</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">fetch</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token constant\">PR_NUDGE_WEBHOOK</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>dataObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">responseType</span><span class=\"token operator\">:</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">nocache</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">onload</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> response <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">onerror</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> err <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>Add button to the page</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">nudgeButton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> onNudgeBtnClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  reviewersFormElement<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>nudgeButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Final result</h2>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ==UserScript==</span>\n<span class=\"token comment\">// @name         &#x3C;Your Company> PR nudge</span>\n<span class=\"token comment\">// @namespace    https://github.com/&#x3C;Your Company></span>\n<span class=\"token comment\">// @version      1.0.0</span>\n<span class=\"token comment\">// @description  Nudge PR reviewers</span>\n<span class=\"token comment\">// @author       You</span>\n<span class=\"token comment\">// @match        https://github.com/&#x3C;Your Company>/*/pull/*</span>\n<span class=\"token comment\">// @icon         https://www.google.com/s2/favicons?sz=64&#x26;domain=github.com</span>\n<span class=\"token comment\">// @grant        GM_xmlhttpRequest</span>\n<span class=\"token comment\">// @connect      slack.com</span>\n<span class=\"token comment\">// ==/UserScript==</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">GithubSlackMap</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">strdr4605</span><span class=\"token operator\">:</span> <span class=\"token string\">\"U**********\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token spread operator\">...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">PR_NUDGE_WEBHOOK</span> <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"https://hooks.slack.com/services/********/***********/************************\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> nudgeButton <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  nudgeButton<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Nudge reviewers\"</span><span class=\"token punctuation\">;</span>\n  nudgeButton<span class=\"token punctuation\">.</span><span class=\"token property-access\">className</span> <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"btn btn-sm js-details-target d-inline-block float-left float-none m-0 mr-md-0 js-title-edit-button\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> reviewersFormElement <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"reviewers-select-menu\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">parentElement</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">getAllAwaiting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> allReviewers <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>reviewersFormElement<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> awaiting <span class=\"token operator\">=</span> allReviewers<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reviewerEl</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span>\n      reviewerEl\n        <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span[aria-label]\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aria-label\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Awaiting\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> awaitingNicknames <span class=\"token operator\">=</span> awaiting<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">reviewerEl</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> reviewerEl<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> awaitingNicknames<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">slackMention</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">githugNickname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">GithubSlackMap</span><span class=\"token punctuation\">[</span>githugNickname<span class=\"token punctuation\">]</span>\n      <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x3C;@</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token maybe-class-name\">GithubSlackMap</span><span class=\"token punctuation\">[</span>githugNickname<span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">></span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token operator\">:</span> githugNickname<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">onNudgeBtnClick</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> prLink <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> prTitle <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" by \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> prLink<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> awaitingReviewers <span class=\"token operator\">=</span> <span class=\"token function\">getAllAwaiting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>awaitingReviewers<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> dataObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hey </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>awaitingReviewers<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>\n        slackMention\n      <span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,\\nI really need your review on &#x3C;</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>prLink<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">|</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>prTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">>. ü•∫üòáüôèüòä</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\"><span class=\"token maybe-class-name\">GM_xmlhttpRequest</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">fetch</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token constant\">PR_NUDGE_WEBHOOK</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>dataObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">responseType</span><span class=\"token operator\">:</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">nocache</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">onload</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> response <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">onerror</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> err <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  nudgeButton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> onNudgeBtnClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    reviewersFormElement<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>nudgeButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now when clicking <strong>Nudge reviewers</strong> your teammates will be notified and will review your changes faster.</p>\n<h2>Final step</h2>\n<blockquote>\n<p>Don't expose webhook URL to the public!</p>\n</blockquote>\n<p>Add the script to a private repo(<code class=\"language-unknown\">company-userscripts</code>) in your Github org.\nName it <code class=\"language-unknown\">PR-nudge.user.js</code>.<br>\nTell teammates to install Tampermonkey and send them:<br>\n<a href=\"https://github.com/Org/org-userscripts/blob/master/PR-nudge.user.js?raw=1\">https://github.com/Org/org-userscripts/blob/master/PR-nudge.user.js?raw=1</a><br>\nto add the script on their machine.</p>\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true}