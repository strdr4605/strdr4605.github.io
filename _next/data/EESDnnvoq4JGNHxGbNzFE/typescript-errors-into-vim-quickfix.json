{"pageProps":{"postData":{"title":"Typescript errors into vim quickfix","date":"2022-11-04T00:00:00.000Z","description":"How to populate errors from running tsc in vim/neovim quickfix. Get typescript compiler errors inside vim.","tags":["vim"],"slug":"typescript-errors-into-vim-quickfix","contentHtml":"<p>You may use LSP and <code class=\"language-unknown\">lua vim.diagnostic.setloclist()</code> to show Typescript errors for a specific buffer. But sometimes you could have errors across the whole project.\nYou can run <code class=\"language-unknown\">tsc</code> in the terminal and manually search for files with errors. But we can do better.</p>\n<p>Vim has the <code class=\"language-unknown\">:make</code> command which executes the program that is set into <code class=\"language-unknown\">makeprg</code>. By default, it's <code class=\"language-unknown\">make</code> but we can change it to any terminal program/command.\nThe output of <code class=\"language-unknown\">makeprg</code> is then populated into quickfix.</p>\n<h2>Update üñäÔ∏è</h2>\n<p>After discussion on reddit someone suggested a better approach.\nThe error is already parced in <a href=\"https://github.com/neovim/neovim/blob/master/runtime/compiler/tsc.vim\"><code class=\"language-unknown\">compiler tsc</code></a>.\nI just change <code class=\"language-unknown\">makeprg=npx\\ tsc</code> instead of <code class=\"language-unknown\">makeprg=tsc</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token keyword\">vim</span><span class=\"token operator\">.</span>cmd <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n  augroup strdr4605\n    <span class=\"token builtin\">autocmd</span> FileType typescript<span class=\"token punctuation\">,</span>typescriptreact <span class=\"token keyword\">compiler</span> tsc | <span class=\"token keyword\">setlocal</span> <span class=\"token builtin\">makeprg</span><span class=\"token operator\">=</span>npx\\ tsc\n  augroup END\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<h2>Initial post</h2>\n<p>Let's create an auto command that will set makeprg to <code class=\"language-unknown\">tsc</code> if we are in a typescript project:</p>\n<div class=\"remark-highlight\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token keyword\">vim</span><span class=\"token operator\">.</span>cmd <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n  augroup strdr4605\n    <span class=\"token builtin\">autocmd</span> FileType typescript<span class=\"token punctuation\">,</span>typescriptreact <span class=\"token keyword\">set</span> <span class=\"token builtin\">makeprg</span><span class=\"token operator\">=</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>node_modules<span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>tsc\n  augroup END\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>or with lua API:</p>\n<div class=\"remark-highlight\"><pre class=\"language-vim\"><code class=\"language-vim\">local augroup <span class=\"token operator\">=</span> <span class=\"token keyword\">vim</span><span class=\"token operator\">.</span>api<span class=\"token operator\">.</span><span class=\"token function\">nvim_create_augroup</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"strdr4605\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> clear <span class=\"token operator\">=</span> true <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">vim</span><span class=\"token operator\">.</span>api<span class=\"token operator\">.</span><span class=\"token function\">nvim_create_autocmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FileType\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  pattern <span class=\"token operator\">=</span> <span class=\"token string\">\"typescript,typescriptreact\"</span><span class=\"token punctuation\">,</span>\n  group <span class=\"token operator\">=</span> augroup<span class=\"token punctuation\">,</span>\n  command <span class=\"token operator\">=</span> <span class=\"token string\">\"compiler tsc | setlocal makeprg=npx\\\\ tsc\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Run <code class=\"language-unknown\">:make</code> and see the output:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">:<span class=\"token operator\">!</span>./node_modules/.bin/tsc  <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&#x26;1</span><span class=\"token operator\">|</span> <span class=\"token function\">tee</span> /var/folders/3w/m_v388s15pq9rpgswbt131w00000gn/T/nvim.strdr4605/708JAY/2\ncomponents/Date.tsx<span class=\"token punctuation\">(</span><span class=\"token number\">6,28</span><span class=\"token punctuation\">)</span>: error TS2339: Property <span class=\"token string\">'toISOString'</span> does not exist on <span class=\"token builtin class-name\">type</span> <span class=\"token string\">'number'</span><span class=\"token builtin class-name\">.</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> of <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>: components/Date.tsx<span class=\"token punctuation\">(</span><span class=\"token number\">6,28</span><span class=\"token punctuation\">)</span>: error TS2339: Property <span class=\"token string\">'toISOString'</span> does not exist on <span class=\"token builtin class-name\">type</span> <span class=\"token string\">'number'</span><span class=\"token builtin class-name\">.</span>\nPress ENTER or <span class=\"token builtin class-name\">type</span> <span class=\"token builtin class-name\">command</span> to <span class=\"token builtin class-name\">continue</span>\n</code></pre></div>\n<p>and open the quickfix, <code class=\"language-unknown\">:copen</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">components/Date.tsx<span class=\"token punctuation\">(</span><span class=\"token number\">6,28</span><span class=\"token punctuation\">)</span>: error TS2339: Property <span class=\"token string\">'toISOString'</span> does not exist on <span class=\"token builtin class-name\">type</span> <span class=\"token string\">'number'</span><span class=\"token builtin class-name\">.</span>\n</code></pre></div>\n<p>When trying to navigate to any file from quickfix, I see this error: <code class=\"language-unknown\">Buffer not found</code>.\nWhy? Because the <code class=\"language-unknown\">tsc</code> compiler outputs in a format that is not clear for vim quickfix.</p>\n<p>The problem is in parenthesis around the file line and column: <code class=\"language-unknown\">components/Date.tsx(6,28):</code></p>\n<p>But we can change this by piping the <code class=\"language-unknown\">tsc</code> output to <code class=\"language-unknown\">sed</code> command and replacing <code class=\"language-unknown\">(6,28)</code> with <code class=\"language-unknown\">:6:28:</code>.</p>\n<p>This is the output if we run it in the terminal:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">./node_modules/.bin/tsc <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/(\\(.*\\),\\(.*\\)):/:\\1:\\2:/'</span>                                                                                 <span class=\"token number\">130</span> ‚Üµ\n\ncomponents/Date.tsx:6:28: error TS2339: Property <span class=\"token string\">'toISOString'</span> does not exist on <span class=\"token builtin class-name\">type</span> <span class=\"token string\">'number'</span><span class=\"token builtin class-name\">.</span>\n</code></pre></div>\n<p>But to make it work in vim, we need to escape some chars.\nThe final result is:</p>\n<div class=\"remark-highlight\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token keyword\">vim</span><span class=\"token operator\">.</span>cmd <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n  augroup strdr4605\n    <span class=\"token builtin\">autocmd</span> FileType typescript<span class=\"token punctuation\">,</span>typescriptreact <span class=\"token keyword\">set</span> <span class=\"token builtin\">makeprg</span><span class=\"token operator\">=</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>node_modules<span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>tsc\\ \\\\\\|\\ sed\\ <span class=\"token string\">'s/(\\\\(.*\\\\),\\\\(.*\\\\)):/:\\\\1:\\\\2:/'</span>\n  augroup END\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>Now when running <code class=\"language-unknown\">:make</code> the quickfix list is populated correctly and vim navigates to the first file in the list.\nI can fix Typescript errors one by one, by navigating with <code class=\"language-unknown\">:cnext</code> or using <a href=\"https://github.com/tpope/vim-unimpaired\">vim-unimpaired</a>.</p>\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true}