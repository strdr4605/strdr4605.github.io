<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>How to gradually add an eslint rule</title><meta name="description" content="Sometimes you decide to add a new eslint plugin or rule to your javascript project. To not do 2000+ files change you may try to gradually change files with lint-staged."/><meta property="og:title" content="How to gradually add an eslint rule"/><meta property="og:description" content="Sometimes you decide to add a new eslint plugin or rule to your javascript project. To not do 2000+ files change you may try to gradually change files with lint-staged."/><meta property="og:image" content="https://strdr4605.com/how-to-gradually-add-an-eslint-rule.jpg"/><meta property="og:type" content="article"/><link rel="canonical" href="https://strdr4605.com/how-to-gradually-add-an-eslint-rule"/><meta name="next-head-count" content="9"/><meta charSet="UTF-8"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><meta property="og:locale" content="en_GB"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@strdr4605"/><meta name="theme-color" content="#FAF181"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-171697116-1"></script><script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());

                    gtag('config', 'UA-171697116-1', {
                      page_path: window.location.pathname,
                    });
                  </script><link rel="preload" href="/_next/static/css/83a77daccbc30077.css" as="style"/><link rel="stylesheet" href="/_next/static/css/83a77daccbc30077.css" data-n-g=""/><link rel="preload" href="/_next/static/css/bc274fc7c99985a3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bc274fc7c99985a3.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9e60bad828f3ecaa.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-e267bb9839e5051c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-960db24c14844c7a.js" defer=""></script><script src="/_next/static/chunks/453-0a4b1ae71b489eee.js" defer=""></script><script src="/_next/static/chunks/pages/%5BpostSlug%5D-2bfde3a588be30eb.js" defer=""></script><script src="/_next/static/19TnfpwjJv-nMdToehlrZ/_buildManifest.js" defer=""></script><script src="/_next/static/19TnfpwjJv-nMdToehlrZ/_ssgManifest.js" defer=""></script><script src="/_next/static/19TnfpwjJv-nMdToehlrZ/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Layout_container__n__U4"><article><h1>How to gradually add an eslint rule</h1><i><time dateTime="2022-05-17">17 May 2022</time></i> on <a href="/"><span>Dragoș Străinu</span>&#x27;s blog</a><br/><div><p>As your javascript project grows and new engineers are joining the team, you may try to add new eslint plugins and rules to make the code base more rigid.</p>
<p>The problem is that often these new eslint rules may require changes in all project files, and as your project is big enough, you may have a situation when eslint rules require changes in <a href="/how-i-found-a-bug-in-2000-files">2000+ files</a>.</p>
<p>What if you could gradually enforce an eslint rule, without breaking the CI of your project.</p>
<p>We can do this using <a href="https://github.com/okonet/lint-staged">lint-staged</a>, <a href="https://typicode.github.io/husky/">husky</a>, and some changes in the <code>.eslintrc.js</code> file.</p>
<p>I hope you are already using <code>lint-staged</code> with <code>husky</code>. If not, please set up it.</p>
<p>Your <code>.lintstagedrc.js</code> file may look something like this:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// .lintstagedrc.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'*.{js,jsx,ts,tsx}'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'prettier --write'</span><span class="token punctuation">,</span> <span class="token string">'eslint --quiet --fix'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">'*.css'</span><span class="token operator">:</span> <span class="token string">'stylelint --fix'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'*.md'</span><span class="token operator">:</span> <span class="token string">'prettier --write'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>You may also have a script in your <code>package.json</code> file, that you run in CI to make sure eslint rules are followed:</p>
<div class="remark-highlight"><pre class="language-json"><code class="language-json">...
<span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"eslint:run"</span><span class="token operator">:</span> <span class="token string">"eslint --ext=.js,.jsx,.ts,.tsx --quiet ."</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Now let's say you want to enforce the removal of all console logs using the eslint rule <code>no-console</code>.</p>
<p>In your <code>.eslintrc.js</code> file, set the rule to warning:</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token spread operator">...</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'no-console'</span><span class="token operator">:</span> <span class="token string">'warn'</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
</code></pre></div>
<p>Now running <code>npm run eslint:run</code> will just show a bunch of warnings but will pass the check.</p>
<p>Next, you need to create a new eslintrc file that will be used only by <code>lint-staged</code>. Let's name it <code>eslintrc-staged.js</code>.
There you need to extend the default eslint config and override the rule to error.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// .eslintrc-staged.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">'./.eslintrc.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'no-console'</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The last change needs to be done in <code>.lintstagedrc.js</code> to tell lint-staged to use another config file when running eslint.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'*.{js,jsx,ts,tsx}'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'prettier --write'</span><span class="token punctuation">,</span> <span class="token string">'eslint -c eslintrc-staged.js --no-eslintrc --quiet --fix'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">'*.css'</span><span class="token operator">:</span> <span class="token string">'stylelint --fix'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'*.md'</span><span class="token operator">:</span> <span class="token string">'prettier --write'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Now, when doing changes to the project, eslint will throw errors only to the files that were changed before the commit.</p>
</div><footer class="PostFooter_footer__nLJ4b">Liked this post? Follow me<!-- --> <a target="_blank" href="http://twitter.com/strdr4605" rel="noreferrer">@strdr4605</a> <!-- -->to get more updates.</footer></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"title":"How to gradually add an eslint rule","date":"2022-05-17T00:00:00.000Z","description":"Sometimes you decide to add a new eslint plugin or rule to your javascript project. To not do 2000+ files change you may try to gradually change files with lint-staged.","tags":["development"],"slug":"how-to-gradually-add-an-eslint-rule","contentHtml":"\u003cp\u003eAs your javascript project grows and new engineers are joining the team, you may try to add new eslint plugins and rules to make the code base more rigid.\u003c/p\u003e\n\u003cp\u003eThe problem is that often these new eslint rules may require changes in all project files, and as your project is big enough, you may have a situation when eslint rules require changes in \u003ca href=\"/how-i-found-a-bug-in-2000-files\"\u003e2000+ files\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWhat if you could gradually enforce an eslint rule, without breaking the CI of your project.\u003c/p\u003e\n\u003cp\u003eWe can do this using \u003ca href=\"https://github.com/okonet/lint-staged\"\u003elint-staged\u003c/a\u003e, \u003ca href=\"https://typicode.github.io/husky/\"\u003ehusky\u003c/a\u003e, and some changes in the \u003ccode\u003e.eslintrc.js\u003c/code\u003e file.\u003c/p\u003e\n\u003cp\u003eI hope you are already using \u003ccode\u003elint-staged\u003c/code\u003e with \u003ccode\u003ehusky\u003c/code\u003e. If not, please set up it.\u003c/p\u003e\n\u003cp\u003eYour \u003ccode\u003e.lintstagedrc.js\u003c/code\u003e file may look something like this:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// .lintstagedrc.js\u003c/span\u003e\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.{js,jsx,ts,tsx}'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'prettier --write'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'eslint --quiet --fix'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.css'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'stylelint --fix'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.md'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'prettier --write'\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou may also have a script in your \u003ccode\u003epackage.json\u003c/code\u003e file, that you run in CI to make sure eslint rules are followed:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e...\n\u003cspan class=\"token property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"eslint:run\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"eslint --ext=.js,.jsx,.ts,.tsx --quiet .\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow let's say you want to enforce the removal of all console logs using the eslint rule \u003ccode\u003eno-console\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIn your \u003ccode\u003e.eslintrc.js\u003c/code\u003e file, set the rule to warning:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// .eslintrc.js\u003c/span\u003e\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003erules\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e'no-console'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'warn'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow running \u003ccode\u003enpm run eslint:run\u003c/code\u003e will just show a bunch of warnings but will pass the check.\u003c/p\u003e\n\u003cp\u003eNext, you need to create a new eslintrc file that will be used only by \u003ccode\u003elint-staged\u003c/code\u003e. Let's name it \u003ccode\u003eeslintrc-staged.js\u003c/code\u003e.\nThere you need to extend the default eslint config and override the rule to error.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// .eslintrc-staged.js\u003c/span\u003e\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./.eslintrc.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003erules\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e'no-console'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'error'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe last change needs to be done in \u003ccode\u003e.lintstagedrc.js\u003c/code\u003e to tell lint-staged to use another config file when running eslint.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003emodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.{js,jsx,ts,tsx}'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'prettier --write'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'eslint -c eslintrc-staged.js --no-eslintrc --quiet --fix'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.css'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'stylelint --fix'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e'*.md'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'prettier --write'\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, when doing changes to the project, eslint will throw errors only to the files that were changed before the commit.\u003c/p\u003e\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true},"page":"/[postSlug]","query":{"postSlug":"how-to-gradually-add-an-eslint-rule"},"buildId":"19TnfpwjJv-nMdToehlrZ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>