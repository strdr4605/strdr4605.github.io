<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>How I found a bug in 2000 files</title><meta name="description" content="A story how I found a bug in a change of 2000 files using bash, git commits and git bisect. Another title for this post cound be How to creat a commit per file that was changed."/><meta property="og:title" content="How I found a bug in 2000 files"/><meta property="og:description" content="A story how I found a bug in a change of 2000 files using bash, git commits and git bisect. Another title for this post cound be How to creat a commit per file that was changed."/><meta property="og:image" content="https://strdr4605.com/how-i-found-a-bug-in-2000-files.jpg"/><meta property="og:type" content="article"/><link rel="canonical" href="https://strdr4605.com/how-i-found-a-bug-in-2000-files"/><link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/plugins/diff-highlight/prism-diff-highlight.min.css"/><meta name="next-head-count" content="10"/><meta charSet="UTF-8"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><meta property="og:locale" content="en_GB"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@strdr4605"/><meta name="theme-color" content="#FAF181"/><link rel="preload" href="/_next/static/css/48668f542c06fc2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/48668f542c06fc2b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7bca23aa3c575c28.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7bca23aa3c575c28.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-40178e826cefb0bf.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-e267bb9839e5051c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0c351108ffe6ee8e.js" defer=""></script><script src="/_next/static/chunks/453-0a4b1ae71b489eee.js" defer=""></script><script src="/_next/static/chunks/pages/%5BpostSlug%5D-c12f688e065745e2.js" defer=""></script><script src="/_next/static/uPc_55N1LlphTR7DT_MUF/_buildManifest.js" defer=""></script><script src="/_next/static/uPc_55N1LlphTR7DT_MUF/_ssgManifest.js" defer=""></script><script src="/_next/static/uPc_55N1LlphTR7DT_MUF/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Layout_container__n__U4"><article><h1>How I found a bug in 2000 files</h1><i><time dateTime="2022-05-13">13 May 2022</time></i> on <a href="/"><span>Dragoș Străinu</span>&#x27;s blog</a><br/><div><p>I was adding a new eslint plugin that will sort imports in js/ts files.<br>
After adding <a href="https://github.com/lydell/eslint-plugin-simple-import-sort">eslint-plugin-simple-import-sort</a>,
I run <code>eslint --fix</code> and found about 2000 files changed.
As there was only reorder of imports I thought that there should not be any issues.</p>
<p>I was surprised when I found a very strange</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">TypeError: Cannot read properties of undefined</code></pre></div>
<p>Reverting the import order did not help to fix the issue.<br>
And now I started thinking  about how I can find the issue without going through all 2000 files.</p>
<p>Then an idea came. As all changes are independent,
I could do a commit for every file change and then run a <code>git bisect</code> and find the file that causes the problem.</p>
<p>So I created a bash script that will get all file names from <code>git status</code> and create a commit with the file name:</p>
<p>Let's see how:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> status <span class="token parameter variable">--porcelain</span> <span class="token comment"># prints git status in a format that can be parsed</span>
<span class="token comment"># M utils/index.ts</span>
<span class="token comment"># M components/Button.tsx</span>
<span class="token comment"># ...</span>
</code></pre></div>
<p>Then we pipe this result to <code>awk</code> and print only the file name:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> status <span class="token parameter variable">--porcelain</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span>
<span class="token comment"># utils/index.ts</span>
<span class="token comment"># components/Button.tsx</span>
<span class="token comment"># ...</span>
</code></pre></div>
<p>read each line (filename), and do a commit with <code>--no-verify</code> to not trigger pre-commit check:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token punctuation">(</span>git status <span class="token parameter variable">--porcelain</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token punctuation">)</span> <span class="token operator">|</span> 
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> line
<span class="token keyword">do</span>
    <span class="token function">git</span> <span class="token function">add</span> <span class="token variable">$line</span>
    <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Add file <span class="token variable">$line</span>"</span> --no-verify
<span class="token keyword">done</span>
</code></pre></div>
<p>After running this script I had about 2000 commits where I could run <a href="https://git-scm.com/docs/git-bisect"><code>git bisect</code></a> and find the issue.
<code>git bisect</code> reduced the number of checks from <strong>2000</strong> (theoretically) to just <strong>11</strong>.</p>
<p>I found the file that caused the issue, and it was completely unrelated to the file where the error was thrown.
So I just eslint ignored the sorting rule in that file (till later investigation).
Then I did a soft reset to undo all 2000 commits and pushed a single commit that successfully adds the new eslint plugin and rules to the project.</p>
</div><footer class="PostFooter_footer__nLJ4b">Liked this post? Follow me<!-- --> <a target="_blank" href="http://twitter.com/strdr4605" rel="noreferrer">@strdr4605</a> <!-- -->to get more updates.</footer></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"title":"How I found a bug in 2000 files","date":"2022-05-13T00:00:00.000Z","description":"A story how I found a bug in a change of 2000 files using bash, git commits and git bisect. Another title for this post cound be How to creat a commit per file that was changed.","tags":["development"],"slug":"how-i-found-a-bug-in-2000-files","contentHtml":"\u003cp\u003eI was adding a new eslint plugin that will sort imports in js/ts files.\u003cbr\u003e\nAfter adding \u003ca href=\"https://github.com/lydell/eslint-plugin-simple-import-sort\"\u003eeslint-plugin-simple-import-sort\u003c/a\u003e,\nI run \u003ccode\u003eeslint --fix\u003c/code\u003e and found about 2000 files changed.\nAs there was only reorder of imports I thought that there should not be any issues.\u003c/p\u003e\n\u003cp\u003eI was surprised when I found a very strange\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eTypeError: Cannot read properties of undefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eReverting the import order did not help to fix the issue.\u003cbr\u003e\nAnd now I started thinking  about how I can find the issue without going through all 2000 files.\u003c/p\u003e\n\u003cp\u003eThen an idea came. As all changes are independent,\nI could do a commit for every file change and then run a \u003ccode\u003egit bisect\u003c/code\u003e and find the file that causes the problem.\u003c/p\u003e\n\u003cp\u003eSo I created a bash script that will get all file names from \u003ccode\u003egit status\u003c/code\u003e and create a commit with the file name:\u003c/p\u003e\n\u003cp\u003eLet's see how:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token function\"\u003egit\u003c/span\u003e status \u003cspan class=\"token parameter variable\"\u003e--porcelain\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# prints git status in a format that can be parsed\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# M utils/index.ts\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# M components/Button.tsx\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen we pipe this result to \u003ccode\u003eawk\u003c/code\u003e and print only the file name:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token function\"\u003egit\u003c/span\u003e status \u003cspan class=\"token parameter variable\"\u003e--porcelain\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token function\"\u003eawk\u003c/span\u003e \u003cspan class=\"token string\"\u003e'{print $2}'\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# utils/index.ts\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# components/Button.tsx\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# ...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eread each line (filename), and do a commit with \u003ccode\u003e--no-verify\u003c/code\u003e to not trigger pre-commit check:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token shebang important\"\u003e#!/bin/bash\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egit status \u003cspan class=\"token parameter variable\"\u003e--porcelain\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token function\"\u003eawk\u003c/span\u003e \u003cspan class=\"token string\"\u003e'{print $2}'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \n\u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token builtin class-name\"\u003eread\u003c/span\u003e \u003cspan class=\"token parameter variable\"\u003e-r\u003c/span\u003e line\n\u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egit\u003c/span\u003e \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$line\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egit\u003c/span\u003e commit \u003cspan class=\"token parameter variable\"\u003e-m\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Add file \u003cspan class=\"token variable\"\u003e$line\u003c/span\u003e\"\u003c/span\u003e --no-verify\n\u003cspan class=\"token keyword\"\u003edone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter running this script I had about 2000 commits where I could run \u003ca href=\"https://git-scm.com/docs/git-bisect\"\u003e\u003ccode\u003egit bisect\u003c/code\u003e\u003c/a\u003e and find the issue.\n\u003ccode\u003egit bisect\u003c/code\u003e reduced the number of checks from \u003cstrong\u003e2000\u003c/strong\u003e (theoretically) to just \u003cstrong\u003e11\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eI found the file that caused the issue, and it was completely unrelated to the file where the error was thrown.\nSo I just eslint ignored the sorting rule in that file (till later investigation).\nThen I did a soft reset to undo all 2000 commits and pushed a single commit that successfully adds the new eslint plugin and rules to the project.\u003c/p\u003e\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true},"page":"/[postSlug]","query":{"postSlug":"how-i-found-a-bug-in-2000-files"},"buildId":"uPc_55N1LlphTR7DT_MUF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>