<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>NodeJS: How to test the npm package before releasing</title><meta name="description" content="How to test and release an npm package when it is still a Work In Progress. How to create prereleases of a NodeJS package following semver.org convention."/><meta property="og:title" content="NodeJS: How to test the npm package before releasing"/><meta property="og:description" content="How to test and release an npm package when it is still a Work In Progress. How to create prereleases of a NodeJS package following semver.org convention."/><meta property="og:image" content="https://strdr4605.com/node-js-how-to-test-the-npm-package-before-releasing.jpg"/><meta property="og:type" content="article"/><link rel="canonical" href="https://strdr4605.com/node-js-how-to-test-the-npm-package-before-releasing"/><link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/plugins/diff-highlight/prism-diff-highlight.min.css"/><meta name="next-head-count" content="10"/><meta charSet="UTF-8"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><meta property="og:locale" content="en_GB"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@strdr4605"/><meta name="theme-color" content="#FAF181"/><link rel="preload" href="/_next/static/css/48668f542c06fc2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/48668f542c06fc2b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7bca23aa3c575c28.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7bca23aa3c575c28.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-40178e826cefb0bf.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-e267bb9839e5051c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0c351108ffe6ee8e.js" defer=""></script><script src="/_next/static/chunks/453-0a4b1ae71b489eee.js" defer=""></script><script src="/_next/static/chunks/pages/%5BpostSlug%5D-c12f688e065745e2.js" defer=""></script><script src="/_next/static/bHWSbGSlV3Tgq33qiRPPc/_buildManifest.js" defer=""></script><script src="/_next/static/bHWSbGSlV3Tgq33qiRPPc/_ssgManifest.js" defer=""></script><script src="/_next/static/bHWSbGSlV3Tgq33qiRPPc/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Layout_container__n__U4"><article><h1>NodeJS: How to test the npm package before releasing</h1><i><time dateTime="2022-04-15">15 Apr 2022</time></i> on <a href="/"><span>Dragoș Străinu</span>&#x27;s blog</a><br/><div><p>Let's say you have a <strong>core</strong> package that is used in your <strong>app</strong> and <strong>mobile</strong> projects.</p>
<p>Now you need to do some changes, both in <strong>core</strong> and <strong>app</strong>.</p>
<p>In the process of local development, you should test that <strong>core</strong> is working correctly with <strong>app</strong> before the release.
You can use <a href="https://docs.npmjs.com/cli/v8/commands/npm-link"><code>npm link</code></a>, but from my experience, it's not always working as expected.</p>
<p>A better alternative is <a href="https://github.com/wclr/yalc">yalc</a>. You can check it yourself, but shortly, as the package itself says:</p>
<blockquote>
<p>Better workflow than <strong>npm | yarn link</strong> for package authors</p>
</blockquote>
<p>After everything is working locally, you are ready to do a Pull Request.
But wait! The CI will fail because the new version of <strong>core</strong> is only available locally.</p>
<p>To fix this, we need a prerelease version of the <strong>core</strong> that will be installed in CI, or then other engineers will try it on their machines.</p>
<p>Let's, say the previous version of <strong>core</strong> was <code>1.0.1</code>, and you are working on future <code>1.0.2</code>.</p>
<p><a href="https://semver.org/spec/v2.0.0-rc.1.html">Semver.org docs</a> suggests to use <code>1.0.2-rc.1</code> (release candidate),
but this approach does not work well when you are working on a project where many engineers can release to <strong>core</strong> before you.</p>
<p>From my experience, the best is to have a prerelease version that is associated with some issue/ticket/task number in the format:</p>
<p><strong><code>&#x3C;current version></code></strong>-<strong><code>&#x3C;issue number></code></strong>.<strong><code>&#x3C;WIP version></code></strong></p>
<p>Example: <code>1.0.1-4605.0</code>, <code>1.0.1-4605.1</code> ...</p>
<p>The important part before publishing such a prerelease version is to set a tag.
If you don't set a tag, the package will be published as <code>latest</code>,
and then someone will try to install the <strong>core</strong> package, it will get the wrong "<code>latest</code>" version which may still be WIP.<br>
For this, you might use the <code>dev</code> tag.</p>
<h2>So, the workflow</h2>
<ol>
<li>You do changes in <strong>core</strong></li>
<li>Use the WIP version of <strong>core</strong> in <strong>app</strong> locally using <code>yalc</code></li>
<li>When the task is ready:</li>
</ol>
<ul>
<li>Change the version of <strong>core</strong>: <code>1.0.1-4605.0</code></li>
<li>Publish the WIP version: <code>npm publish --tag dev</code></li>
<li>Update the <strong>app</strong> with WIP version of <strong>core</strong>
<ul>
<li><code>npm install core@dev</code></li>
<li>or manually set <strong>core</strong> version in <strong>app</strong> <code>package.json</code> and do <code>npm install</code></li>
</ul>
</li>
<li>Do more WIP prereleases if needed: <code>1.0.1-4605.1</code></li>
</ul>
<ol start="4">
<li>Create PRs for both projects</li>
<li>When <strong>core</strong> PR is approved</li>
</ol>
<ul>
<li>Merge <strong>core</strong></li>
<li>Set new version <code>1.0.2</code></li>
<li>Publish <strong>core</strong>: <code>npm publish</code> (<code>latest</code> tag is default)</li>
</ul>
<ol start="6">
<li>Update <strong>app</strong> PR with new version of <strong>core</strong></li>
<li>Merge <strong>app</strong> changes into master</li>
<li>Happy coding</li>
</ol>
</div><footer class="PostFooter_footer__nLJ4b">Liked this post? Follow me<!-- --> <a target="_blank" href="http://twitter.com/strdr4605" rel="noreferrer">@strdr4605</a> <!-- -->to get more updates.</footer></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"title":"NodeJS: How to test the npm package before releasing","date":"2022-04-15T00:00:00.000Z","description":"How to test and release an npm package when it is still a Work In Progress. How to create prereleases of a NodeJS package following semver.org convention.","tags":["development","node","npm"],"slug":"node-js-how-to-test-the-npm-package-before-releasing","contentHtml":"\u003cp\u003eLet's say you have a \u003cstrong\u003ecore\u003c/strong\u003e package that is used in your \u003cstrong\u003eapp\u003c/strong\u003e and \u003cstrong\u003emobile\u003c/strong\u003e projects.\u003c/p\u003e\n\u003cp\u003eNow you need to do some changes, both in \u003cstrong\u003ecore\u003c/strong\u003e and \u003cstrong\u003eapp\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIn the process of local development, you should test that \u003cstrong\u003ecore\u003c/strong\u003e is working correctly with \u003cstrong\u003eapp\u003c/strong\u003e before the release.\nYou can use \u003ca href=\"https://docs.npmjs.com/cli/v8/commands/npm-link\"\u003e\u003ccode\u003enpm link\u003c/code\u003e\u003c/a\u003e, but from my experience, it's not always working as expected.\u003c/p\u003e\n\u003cp\u003eA better alternative is \u003ca href=\"https://github.com/wclr/yalc\"\u003eyalc\u003c/a\u003e. You can check it yourself, but shortly, as the package itself says:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBetter workflow than \u003cstrong\u003enpm | yarn link\u003c/strong\u003e for package authors\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAfter everything is working locally, you are ready to do a Pull Request.\nBut wait! The CI will fail because the new version of \u003cstrong\u003ecore\u003c/strong\u003e is only available locally.\u003c/p\u003e\n\u003cp\u003eTo fix this, we need a prerelease version of the \u003cstrong\u003ecore\u003c/strong\u003e that will be installed in CI, or then other engineers will try it on their machines.\u003c/p\u003e\n\u003cp\u003eLet's, say the previous version of \u003cstrong\u003ecore\u003c/strong\u003e was \u003ccode\u003e1.0.1\u003c/code\u003e, and you are working on future \u003ccode\u003e1.0.2\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://semver.org/spec/v2.0.0-rc.1.html\"\u003eSemver.org docs\u003c/a\u003e suggests to use \u003ccode\u003e1.0.2-rc.1\u003c/code\u003e (release candidate),\nbut this approach does not work well when you are working on a project where many engineers can release to \u003cstrong\u003ecore\u003c/strong\u003e before you.\u003c/p\u003e\n\u003cp\u003eFrom my experience, the best is to have a prerelease version that is associated with some issue/ticket/task number in the format:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003e\u0026#x3C;current version\u003e\u003c/code\u003e\u003c/strong\u003e-\u003cstrong\u003e\u003ccode\u003e\u0026#x3C;issue number\u003e\u003c/code\u003e\u003c/strong\u003e.\u003cstrong\u003e\u003ccode\u003e\u0026#x3C;WIP version\u003e\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eExample: \u003ccode\u003e1.0.1-4605.0\u003c/code\u003e, \u003ccode\u003e1.0.1-4605.1\u003c/code\u003e ...\u003c/p\u003e\n\u003cp\u003eThe important part before publishing such a prerelease version is to set a tag.\nIf you don't set a tag, the package will be published as \u003ccode\u003elatest\u003c/code\u003e,\nand then someone will try to install the \u003cstrong\u003ecore\u003c/strong\u003e package, it will get the wrong \"\u003ccode\u003elatest\u003c/code\u003e\" version which may still be WIP.\u003cbr\u003e\nFor this, you might use the \u003ccode\u003edev\u003c/code\u003e tag.\u003c/p\u003e\n\u003ch2\u003eSo, the workflow\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eYou do changes in \u003cstrong\u003ecore\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eUse the WIP version of \u003cstrong\u003ecore\u003c/strong\u003e in \u003cstrong\u003eapp\u003c/strong\u003e locally using \u003ccode\u003eyalc\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eWhen the task is ready:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eChange the version of \u003cstrong\u003ecore\u003c/strong\u003e: \u003ccode\u003e1.0.1-4605.0\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ePublish the WIP version: \u003ccode\u003enpm publish --tag dev\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eUpdate the \u003cstrong\u003eapp\u003c/strong\u003e with WIP version of \u003cstrong\u003ecore\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003enpm install core@dev\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eor manually set \u003cstrong\u003ecore\u003c/strong\u003e version in \u003cstrong\u003eapp\u003c/strong\u003e \u003ccode\u003epackage.json\u003c/code\u003e and do \u003ccode\u003enpm install\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDo more WIP prereleases if needed: \u003ccode\u003e1.0.1-4605.1\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eCreate PRs for both projects\u003c/li\u003e\n\u003cli\u003eWhen \u003cstrong\u003ecore\u003c/strong\u003e PR is approved\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eMerge \u003cstrong\u003ecore\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eSet new version \u003ccode\u003e1.0.2\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ePublish \u003cstrong\u003ecore\u003c/strong\u003e: \u003ccode\u003enpm publish\u003c/code\u003e (\u003ccode\u003elatest\u003c/code\u003e tag is default)\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eUpdate \u003cstrong\u003eapp\u003c/strong\u003e PR with new version of \u003cstrong\u003ecore\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eMerge \u003cstrong\u003eapp\u003c/strong\u003e changes into master\u003c/li\u003e\n\u003cli\u003eHappy coding\u003c/li\u003e\n\u003c/ol\u003e\n"},"_superjson":{"values":{"postData.date":["Date"]}}},"__N_SSG":true},"page":"/[postSlug]","query":{"postSlug":"node-js-how-to-test-the-npm-package-before-releasing"},"buildId":"bHWSbGSlV3Tgq33qiRPPc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>